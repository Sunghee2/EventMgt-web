extends ../layout

block css
  link(rel='stylesheet' type='text/css' href='/stylesheets/events/index.min.css')
block script
  script(type="text/javascript", src="//dapi.kakao.com/v2/maps/sdk.js?appkey=5161517a9e126daa813c4fc2ef4904ce&libraries=services")

block content
  .small Total #[span#total_num] event(s)
  #map(style="width:50em;height:25em;")
  script.
    $(function() {
      var mapContainer = document.getElementById('map'),
          mapOption = {center: new daum.maps.LatLng(37.566826, 126.9786567), level: 4};
      var map = new daum.maps.Map(mapContainer, mapOption);
      $.ajax({
        method: 'GET',
        url: '/events/map.json',
        success: function(data) {
          var geocoder = new daum.maps.services.Geocoder();
          $("#total_num").text(data.total);
          
          for(var i in data.docs) {
            var d = data.docs[i];
            var title = [];
            var location = [];
            var id = [];
            for(var j = 0; j<=i; j++){
              title.push(data.docs[j].title);
              location.push(data.docs[j].location);
              id.push(data.docs[j]._id);
            }
            var num=i;
            geocoder.addressSearch(location[num], function(result, status) {
              if (status === daum.maps.services.Status.OK) {
                var coords = new daum.maps.LatLng(result[0].y, result[0].x);
                var marker = new daum.maps.Marker({
                  map: map,
                  position: coords
                });
                var content = '<div style="width:150px;text-align:center;padding:6px 0;">'+title[num]+'</div>'
                var infowindow = new daum.maps.InfoWindow({
                  content: content
                });
                infowindow.open(map, marker);
                //- daum.maps.event.addListener(marker, 'click', function(){
                //-   location.replace(`/events/${id[num]};`);
                //- });
                num--;
              }
            });
          }
        }
      });
    });
  
  
            //- script
            //-   |var geocoder = new daum.maps.services.Geocoder();
            //-   |geocoder.addressSearch(event.location, function(result, status) {
            //-   |  if (status === daum.maps.services.Status.OK) {
            //-   |    var coords = new daum.maps.LatLng(result[0].y, result[0].x);
            //-   |    var marker = new daum.maps.Marker({
            //-   |      map: map,
            //-   |      position: coords
            //-   |    });
            //-   |    map.setCenter(coords);
            //-   |  } 
            //-   |});
            //- 
              
